<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Grizz's GitRepoShare</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A collaborative Git repository platform to discover, share, and manage code projects.">
    <meta name="keywords" content="git, repository, code, sharing, collaboration, version control">
    <meta name="author" content="Grizz's GitRepoShare">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="bg-primary text-white py-3 mb-4" role="banner">
        <div class="container d-flex justify-content-between align-items-center flex-wrap">
            <span class="site-title h2" style="color:#fff;" aria-label="GitRepoShare">GitRepoShare</span>
                <button class="btn btn-secondary" aria-label="Toggle dark mode" style="margin-left:1em;">
                    <i class="bi bi-moon"></i>
                </button>
        </div>
    </header>
    <main class="container" role="main">
        <div class="d-flex justify-content-end mb-4">
            <a href="#" class="btn btn-primary">View All Repositories</a>
        </div>
        <section class="mb-4" aria-label="Most Recent Website Updates">
            <h3 class="mb-3" style="color:#2563eb;">Most Recent Website Updates</h3>
            <input type="text" id="update-search" class="form-control mb-3" placeholder="Search updates by user, date, or description..." oninput="filterUpdates()">
            <div id="updates-cards" class="d-flex flex-wrap gap-3"></div>
            <div id="update-detail-modal" class="modal" tabindex="-1" style="display:none;">
      <div class="modal-dialog">
        <div class="modal-content" id="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Update Detail</h5>
            <button type="button" class="btn-close" onclick="closeUpdateModal()"></button>
          </div>
          <div class="modal-body">
            <form id="update-edit-form">
              <div class="mb-2">
                <label for="update-user" class="form-label">User</label>
                <input type="text" class="form-control" id="update-user" name="user" readonly>
              </div>
              <div class="mb-2">
                <label for="update-date" class="form-label">Date</label>
                <input type="text" class="form-control" id="update-date" name="date" readonly>
              </div>
              <div class="mb-2">
                <label for="update-time" class="form-label">Time</label>
                <input type="text" class="form-control" id="update-time" name="time" readonly>
              </div>
              <div class="mb-2">
                <label for="update-type" class="form-label">Type</label>
                <input type="text" class="form-control" id="update-type" name="type" readonly>
              </div>
              <div class="mb-2">
                <label for="update-tags" class="form-label">Tags</label>
                <input type="text" class="form-control" id="update-tags" name="tags" readonly>
              </div>
              <div class="mb-2">
                <label for="update-desc" class="form-label">Description</label>
                <textarea class="form-control" id="update-desc" name="desc" readonly></textarea>
              </div>
              <div id="edit-buttons" style="display:none;">
                <button type="submit" class="btn btn-primary">Save</button>
                <button type="button" class="btn btn-secondary" onclick="toggleEdit(false)">Cancel</button>
              </div>
            </form>
            <button id="edit-btn" class="btn btn-warning mt-2" onclick="toggleEdit(true)">Edit</button>
            <div id="save-confirm" class="alert alert-success mt-2" style="display:none;">Update saved!</div>
          </div>
        </div>
      </div>
    </div>
        </section>
    </main>
    <button class="fab" aria-label="Create Repository" title="Create Repository">
        <i class="bi bi-plus-lg"></i>
    </button>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
<script>
    // Dark mode toggle logic
    const DARK_MODE_KEY = 'colorMode';
    const darkModeBtn = document.querySelector('.btn.btn-secondary[aria-label="Toggle dark mode"]');
    function setColorMode(mode) {
        if (mode === 'dark') {
            document.body.classList.add('dark-mode');
            localStorage.setItem(DARK_MODE_KEY, 'dark');
        } else {
            document.body.classList.remove('dark-mode');
            localStorage.setItem(DARK_MODE_KEY, 'light');
        }
    }
    darkModeBtn?.addEventListener('click', function() {
        const isDark = document.body.classList.contains('dark-mode');
        setColorMode(isDark ? 'light' : 'dark');
    });
    // On page load, restore color mode
    window.addEventListener('DOMContentLoaded', function() {
        const saved = localStorage.getItem(DARK_MODE_KEY);
        if (saved === 'dark') {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }
    });
let updatesData = [];
let filteredUpdates = [];
let editing = false;
let currentIdx = null;
function fetchUpdates() {
  fetch('/updates')
    .then(res => res.json())
    .then(updates => {
      updatesData = updates;
      filteredUpdates = updatesData;
      renderUpdateCards();
    });
}
function filterUpdates() {
  const query = document.getElementById('update-search').value.toLowerCase();
  filteredUpdates = updatesData.filter(update =>
    (update.user || '').toLowerCase().includes(query) ||
    (update.date || '').toLowerCase().includes(query) ||
    (update.detail || '').toLowerCase().includes(query)
  );
  renderUpdateCards();
}
function renderUpdateCards() {
  const container = document.getElementById('updates-cards');
  container.innerHTML = '';
  filteredUpdates.forEach((update, idx) => {
    const card = document.createElement('div');
    card.className = 'card p-3';
    card.style.minWidth = '220px';
    card.innerHTML = `
      <div><strong>User:</strong> ${update.user || 'Admin'}</div>
      <div><strong>Date:</strong> ${update.date}</div>
    `;
    card.onclick = function() {
      const idxInData = updatesData.indexOf(update);
      showUpdateDetail(idxInData);
    };
    container.appendChild(card);
  });
}
function showUpdateDetail(idx) {
  currentIdx = idx;
  const update = updatesData[idx];
  document.getElementById('update-user').value = update.user || 'Admin';
  document.getElementById('update-date').value = update.date;
  document.getElementById('update-time').value = update.time || '';
  document.getElementById('update-type').value = update.type || '';
  document.getElementById('update-tags').value = update.tags || '';
  document.getElementById('update-desc').value = update.detail;
  document.getElementById('update-desc').readOnly = true;
  document.getElementById('edit-btn').style.display = 'block';
  document.getElementById('edit-buttons').style.display = 'none';
  document.getElementById('save-confirm').style.display = 'none';
  document.getElementById('modal-content').classList.remove('editing');
  const modal = document.getElementById('update-detail-modal');
  modal.classList.add('active');
  modal.style.display = 'flex';
}
function toggleEdit(enable) {
  editing = enable;
  document.getElementById('update-desc').readOnly = !enable;
  document.getElementById('edit-btn').style.display = enable ? 'none' : 'block';
  document.getElementById('edit-buttons').style.display = enable ? 'block' : 'none';
  document.getElementById('modal-content').classList.toggle('editing', enable);
}
document.getElementById('update-edit-form').onsubmit = function(e) {
  e.preventDefault();
  saveUpdate(currentIdx);
};
function saveUpdate(idx) {
  const newDesc = document.getElementById('update-desc').value;
  fetch('/update/' + idx, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ detail: newDesc })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === 'success') {
      updatesData[idx].detail = newDesc;
      renderUpdateCards();
      document.getElementById('save-confirm').style.display = 'block';
      toggleEdit(false);
      setTimeout(() => {
        document.getElementById('save-confirm').style.display = 'none';
      }, 1500);
    } else {
      alert('Error updating: ' + data.message);
    }
  });
}
function closeUpdateModal() {
  const modal = document.getElementById('update-detail-modal');
  modal.classList.remove('active');
  modal.style.display = 'none';
  toggleEdit(false);
}
window.addEventListener('DOMContentLoaded', fetchUpdates);
</script>
</body>
</html>
