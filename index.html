<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Grizz's GitRepoShare</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A collaborative Git repository platform to discover, share, and manage code projects.">
    <meta name="keywords" content="git, repository, code, sharing, collaboration, version control">
    <meta name="author" content="Grizz's GitRepoShare">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="bg-primary text-white py-3 mb-4" role="banner">
        <div class="container d-flex justify-content-between align-items-center flex-wrap">
            <span class="site-title h2" style="color:#fff;" aria-label="GitRepoShare">GitRepoShare</span>
            <div class="search-bar" style="position:relative;max-width:220px;">
                <input type="text" id="global-repo-search" placeholder="Search repositories..." aria-label="Search repositories" class="form-control" style="padding-right:2.2em;">
                <span style="position:absolute;right:0.8em;top:50%;transform:translateY(-50%);pointer-events:none;color:#2563eb;">
                    <i class="bi bi-search"></i>
                </span>
            </div>
                <button class="btn btn-secondary" aria-label="Toggle dark mode" style="margin-left:1em;">
                    <i class="bi bi-moon"></i>
                </button>
        </div>
    </header>
    <main class="container" role="main">
        <div class="d-flex justify-content-end mb-4">
            <a href="#" class="btn btn-primary">View All Repositories</a>
        </div>
        <section class="mb-4" aria-label="Most Recent Repositories">
            <h3 class="mb-3" style="color:#2563eb;">Most Recent Repositories</h3>
            <div class="row g-3" id="repo-list-section">
                <div class="col-12 col-sm-6 col-lg-4 repo-card">
                    <div class="card h-100" aria-label="Repository Card">
                        <div class="card-body">
                            <h5 class="card-title"><a href="#" aria-label="View Repo Name">Repo Name</a></h5>
                            <h6 class="card-subtitle mb-2 text-muted">by <span aria-label="Owner">Owner Name</span> on <span aria-label="Date">2025-09-08</span></h6>
                            <p class="card-text">Repository description goes here.</p>
                        </div>
                    </div>
                </div>
                <div class="col-12 text-muted">No repositories found.</div>
            </div>
        </section>
        <section class="mb-4" aria-label="Site Updates">
          <h3 class="mb-3" style="color:#2563eb;">Site Updates</h3>
          <input type="text" id="update-search" class="form-control mb-3" placeholder="Search updates by user, date, or description..." oninput="filterUpdates()">
          <div id="updates-cards" class="d-flex flex-wrap gap-3"></div>
          <div id="update-detail-modal" class="modal" tabindex="-1" style="display:none;">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Update Detail</h5>
                  <button type="button" class="btn-close" onclick="closeUpdateModal()"></button>
                </div>
                <div class="modal-body">
                  <form id="update-edit-form">
                    <div class="mb-2">
                      <label for="update-user" class="form-label">User</label>
                      <input type="text" class="form-control" id="update-user" name="user" readonly>
                    </div>
                    <div class="mb-2">
                      <label for="update-date" class="form-label">Date</label>
                      <input type="text" class="form-control" id="update-date" name="date" readonly>
                    </div>
                    <div class="mb-2">
                      <label for="update-time" class="form-label">Time</label>
                      <input type="text" class="form-control" id="update-time" name="time" readonly>
                    </div>
                    <div class="mb-2">
                      <label for="update-desc" class="form-label">Description</label>
                      <textarea class="form-control" id="update-desc" name="desc"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </section>
    </main>
    <button class="fab" aria-label="Create Repository" title="Create Repository">
        <i class="bi bi-plus-lg"></i>
    </button>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
<script>
    // Dark mode toggle logic
    const DARK_MODE_KEY = 'colorMode';
    const darkModeBtn = document.querySelector('.btn.btn-secondary[aria-label="Toggle dark mode"]');
    function setColorMode(mode) {
        if (mode === 'dark') {
            document.body.classList.add('dark-mode');
            localStorage.setItem(DARK_MODE_KEY, 'dark');
        } else {
            document.body.classList.remove('dark-mode');
            localStorage.setItem(DARK_MODE_KEY, 'light');
        }
    }
    darkModeBtn?.addEventListener('click', function() {
        const isDark = document.body.classList.contains('dark-mode');
        setColorMode(isDark ? 'light' : 'dark');
    });
    // On page load, restore color mode
    window.addEventListener('DOMContentLoaded', function() {
        const saved = localStorage.getItem(DARK_MODE_KEY);
        if (saved === 'dark') {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }
    });
    let updatesData = [];
    let filteredUpdates = [];
    function fetchUpdates() {
      fetch('/updates')
        .then(res => res.json())
        .then(updates => {
          updatesData = updates;
          filteredUpdates = updatesData;
          renderUpdateCards();
        });
    }
    function filterUpdates() {
      const query = document.getElementById('update-search').value.toLowerCase();
      filteredUpdates = updatesData.filter(update =>
        (update.user || '').toLowerCase().includes(query) ||
        (update.date || '').toLowerCase().includes(query) ||
        (update.detail || '').toLowerCase().includes(query)
      );
      renderUpdateCards();
    }
    function renderUpdateCards() {
      const container = document.getElementById('updates-cards');
      container.innerHTML = '';
      filteredUpdates.forEach((update, idx) => {
        const card = document.createElement('div');
        card.className = 'card p-3';
        card.style.minWidth = '220px';
        card.innerHTML = `
          <div><strong>User:</strong> ${update.user || 'Admin'}</div>
          <div><strong>Date:</strong> ${update.date}</div>
          <button class="btn btn-sm btn-info mt-2" onclick="showUpdateDetail(${updatesData.indexOf(update)})">Detail View</button>
        `;
        container.appendChild(card);
      });
    }
    function showUpdateDetail(idx) {
      const update = updatesData[idx];
      document.getElementById('update-user').value = update.user || 'Admin';
      document.getElementById('update-date').value = update.date;
      document.getElementById('update-time').value = update.time || '';
      document.getElementById('update-desc').value = update.detail;
      document.getElementById('update-detail-modal').style.display = 'block';
      document.getElementById('update-edit-form').onsubmit = function(e) {
        e.preventDefault();
        saveUpdate(idx);
      };
    }
    function closeUpdateModal() {
      document.getElementById('update-detail-modal').style.display = 'none';
    }
    function saveUpdate(idx) {
      const newDesc = document.getElementById('update-desc').value;
      fetch('/update/' + idx, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ detail: newDesc })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'success') {
          updatesData[idx].detail = newDesc;
          renderUpdateCards();
          closeUpdateModal();
        } else {
          alert('Error updating: ' + data.message);
        }
      });
    }
    window.addEventListener('DOMContentLoaded', fetchUpdates);
</script>
</body>
</html>
